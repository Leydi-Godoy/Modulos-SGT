<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Turnos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/estilos.css}">
    <link rel="stylesheet" th:href="@{/animac.css}">
</head>
<body>

<div class="container fondo-difuminado text-center mt-5">
    <div class="card bg-dark text-white p-4 shadow-lg">
        <h2 class="mb-4">Gestión de Turnos</h2>

        <!-- Mensajes globales -->
        <div th:if="${mensaje}" class="alert alert-success mt-3" th:text="${mensaje}"></div>
        <div th:if="${error}" class="alert alert-danger mt-3" th:text="${error}"></div>

        <!-- Pestañas -->
        <ul class="nav nav-tabs nav-justified" id="turnosTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active text-white bg-secondary" id="planificar-tab" data-bs-toggle="tab"
                        data-bs-target="#planificar" type="button" role="tab">Planificar Turno</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link text-white bg-success" id="lista-tab" data-bs-toggle="tab"
                        data-bs-target="#lista" type="button" role="tab">Lista de Asignaciones</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link text-white bg-primary" id="detalle-tab" data-bs-toggle="tab"
                        data-bs-target="#detalle" type="button" role="tab">Detalle / Editar</button>
            </li>
        </ul>

        <!-- Contenido de pestañas -->
        <div class="tab-content mt-3 text-start" id="turnosTabContent">

            <!-- Planificar Turno -->
            <div class="tab-pane fade show active" id="planificar" role="tabpanel">
                <!-- Formulario manual -->
                <form th:action="@{/admin/planificar_turnos}" method="post">
                    <div class="mb-3">
                        <label for="colaborador" class="form-label">Seleccionar Colaborador:</label> <!-- Cambiado -->
                        <select id="colaborador" name="colaboradorId" class="form-select" required> <!-- Cambiado -->
                            <option value="">-- Seleccione un colaborador --</option> <!-- Cambiado -->
                            <option th:each="c : ${colaboradores}" th:value="${c.idColaborador}" <!-- Cambiado -->
                                    th:text="${c.usuario.primerNombre + ' ' + c.usuario.primerApellido + ' (' + c.usuario.correo + ')'}"></option> <!-- Cambiado -->
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="fecha" class="form-label">Fecha:</label>
                        <input type="date" id="fecha" name="fecha" class="form-control"
                               th:value="${asignacionTurno != null} ? ${asignacionTurno.fecha} : ''" required/>
                    </div>

                    <div class="mb-3">
                        <label for="turno" class="form-label">Seleccionar Turno:</label>
                        <select id="turno" name="turnoId" class="form-select" required>
                            <option value="">-- Seleccione un turno --</option>
                            <option th:each="t : ${turnos}" 
                                    th:value="${t.idTurno}"
                                    th:text="${t.tipo}"></option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="observaciones" class="form-label">Observaciones:</label>
                        <textarea id="observaciones" name="observaciones" class="form-control"
                                  th:text="${asignacionTurno != null} ? ${asignacionTurno.observaciones} : ''"></textarea>
                    </div>

                    <div class="text-center">
                        <button type="submit" class="btn btn-outline-success">Guardar Turno</button>
                        <a th:href="@{/admin/planificar_turnos}" class="btn btn-outline-secondary ms-2">Cancelar</a>
                    </div>
                </form>

                <hr class="my-4">

                <!-- Formulario generación automática -->
                <h5 class="text-info">Generación Automática de Malla</h5>
                <form th:action="@{/admin/planificar_turnos/generar}" method="post" class="row g-3 mt-2">
                    <div class="col-md-6">
                        <label for="mes" class="form-label">Seleccionar Mes:</label>
                        <input type="month" id="mes" name="mes" class="form-control" required>
                    </div>
                    <div class="col-md-6 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">Generar Malla Automática</button>
                    </div>
                </form>
            </div>

            <!-- Lista de Asignaciones -->
            <div class="tab-pane fade" id="lista" role="tabpanel">
                <div class="table-responsive mt-3">
                    <table class="table table-dark table-hover table-bordered align-middle"
                           th:if="${asignaciones != null and !#lists.isEmpty(asignaciones)}">
                        <thead>
                        <tr>
                            <th>Colaborador</th> <!-- Cambiado -->
                            <th>Fecha</th>
                            <th>Turno</th>
                            <th>Hora Inicio</th>
                            <th>Hora Fin</th>
                            <th>Observaciones</th>
                            <th>Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="asignacion : ${asignaciones}">
                            <td th:text="${asignacion?.colaborador?.usuario?.primerNombre + ' ' + asignacion?.colaborador?.usuario?.primerApellido} ?: 'N/A'"></td> <!-- Cambiado -->
                            <td th:text="${asignacion?.fecha} ?: 'N/A'"></td>
                            <td th:text="${asignacion?.turno?.tipo} ?: 'N/A'"></td>
                            <td th:text="${asignacion?.turno?.horaInicio} ?: 'N/A'"></td>
                            <td th:text="${asignacion?.turno?.horaFin} ?: 'N/A'"></td>
                            <td th:text="${asignacion?.observaciones ?: ''}"></td>
                            <td>
                                <a th:href="@{'/admin/asignaciones/detalle'(colaboradorId=${asignacion?.colaborador?.idColaborador}, turnoId=${asignacion?.turno?.idTurno}, fecha=${asignacion?.fecha})}" <!-- Cambiado -->
                                   class="btn btn-outline-info btn-sm">Detalle</a>
                                <a th:href="@{'/admin/asignaciones/editar'(colaboradorId=${asignacion?.colaborador?.idColaborador}, turnoId=${asignacion?.turno?.idTurno}, fecha=${asignacion?.fecha})}" <!-- Cambiado -->
                                   class="btn btn-outline-warning btn-sm">Editar</a>
                                <a th:href="@{'/admin/asignaciones/eliminar'(colaboradorId=${asignacion?.colaborador?.idColaborador}, turnoId=${asignacion?.turno?.idTurno}, fecha=${asignacion?.fecha})}" <!-- Cambiado -->
                                   class="btn btn-outline-danger btn-sm"
                                   onclick="return confirm('¿Está seguro de eliminar esta asignación?');">Eliminar</a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div th:if="${asignaciones == null or #lists.isEmpty(asignaciones)}" class="alert alert-info mt-3">
                    No hay asignaciones disponibles.
                </div>
            </div>

            <!-- Detalle / Editar Asignación -->
            <div class="tab-pane fade" id="detalle" role="tabpanel">
                <div th:if="${asignacionTurno != null}">
                    <table class="table table-dark table-bordered mt-3">
                        <tbody>
                        <tr>
                            <th>Colaborador</th> <!-- Cambiado -->
                            <td th:text="${asignacionTurno?.colaborador?.usuario?.primerNombre + ' ' + asignacionTurno?.colaborador?.usuario?.primerApellido} ?: 'N/A'"></td> <!-- Cambiado -->
                        </tr>
                        <tr>
                            <th>Fecha</th>
                            <td th:text="${asignacionTurno?.fecha} ?: 'N/A'"></td>
                        </tr>
                        <tr>
                            <th>Turno</th>
                            <td th:text="${asignacionTurno?.turno?.tipo} ?: 'N/A'"></td>
                        </tr>
                        <tr>
                            <th>Hora Inicio</th>
                            <td th:text="${asignacionTurno?.turno?.horaInicio} ?: 'N/A'"></td>
                        </tr>
                        <tr>
                            <th>Hora Fin</th>
                            <td th:text="${asignacionTurno?.turno?.horaFin} ?: 'N/A'"></td>
                        </tr>
                        <tr>
                            <th>Observaciones</th>
                            <td th:text="${asignacionTurno?.observaciones ?: ''}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div th:if="${asignacionTurno == null}" class="alert alert-danger mt-3">
                    No se encontró la asignación.
                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>